<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/src/styles.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Causal - Real-Time Transcription</title>
    <script type="module" src="/src/main.ts" defer></script>
  </head>

  <body>
    <!-- Projects Sidebar -->
    <aside class="projects-sidebar">
      <div class="sidebar-header">
        <h2>Projects</h2>
        <button id="new-project-btn" class="btn-icon" title="New Project">+</button>
      </div>

      <div id="projects-list" class="projects-list">
        <div class="empty-state">
          <p>No projects yet.<br>Click + to create one!</p>
        </div>
      </div>

      <div class="sidebar-footer">
        <button id="diagnostics-btn" class="btn-secondary btn-small">üîç Diagnostics</button>
        <button id="settings-btn" class="btn-secondary btn-small">‚öôÔ∏è Settings</button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <div class="app-header">
        <h1>Causal - Real-Time Transcription</h1>
        <div id="current-project-indicator" class="current-project">
          <span class="project-label">No project selected</span>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="tabs">
        <button class="tab-button active" data-tab="recording">Recording</button>
        <button class="tab-button" data-tab="summary">Summary</button>
      </div>

      <!-- Recording Tab -->
      <div id="recording-tab" class="tab-content active">
        <div class="transcription-controls">
          <div class="control-group">
            <button id="start-btn" class="btn-primary">Start Recording</button>
            <button id="stop-btn" class="btn-danger" disabled>Stop Recording</button>
            <span id="status-indicator" class="status">Ready</span>
          </div>
        </div>

        <div class="transcript-container">
          <div class="transcript-header">
            <h2>Live Transcript</h2>
            <div class="transcript-actions">
              <button id="copy-btn" class="btn-small">Copy</button>
              <button id="clear-btn" class="btn-small">Clear</button>
            </div>
          </div>
          <div id="transcript-display" class="transcript-display">
            <p class="transcript-placeholder">Transcription will appear here...</p>
          </div>
        </div>

        <!-- Recording History Panel -->
        <div class="recording-history-panel">
          <div class="panel-header">
            <h3>Recording History</h3>
            <span id="recording-count" class="recording-count">0 recordings</span>
          </div>

          <div id="recordings-list" class="recordings-list">
            <!-- Dynamically populated recording cards -->
          </div>

          <div id="recordings-empty-state" class="empty-state">
            <p>No recordings yet. Start recording to create one!</p>
          </div>
        </div>
      </div>

      <!-- Summary Tab -->
      <div id="summary-tab" class="tab-content">
        <div id="summary-loading" class="summary-loading" style="display: none;">
          <div class="spinner"></div>
          <p>Generating summary with Claude...</p>
        </div>

        <div id="summary-content" class="summary-content" style="display: none;">
          <!-- Summary Metadata -->
          <div class="summary-metadata">
            <div class="metadata-item">
              <span class="metadata-label">Duration:</span>
              <span id="summary-duration">-</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Chunks:</span>
              <span id="summary-chunks">-</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Words:</span>
              <span id="summary-words">-</span>
            </div>
            <div class="metadata-item">
              <span class="metadata-label">Timestamp:</span>
              <span id="summary-timestamp">-</span>
            </div>
          </div>

          <!-- Executive Summary -->
          <div class="summary-section">
            <h2>Summary</h2>
            <div id="summary-text" class="summary-text"></div>
          </div>

          <!-- Key Points -->
          <div class="summary-section">
            <h2>Key Points</h2>
            <ul id="summary-key-points" class="summary-key-points"></ul>
          </div>

          <!-- Action Items -->
          <div id="action-items-section" class="summary-section">
            <h2>Action Items</h2>
            <ul id="summary-action-items" class="summary-action-items"></ul>
          </div>

          <!-- Full Transcript -->
          <div class="summary-section">
            <details>
              <summary><h2 style="display: inline; cursor: pointer;">Full Transcript</h2></summary>
              <div id="summary-full-transcript" class="summary-full-transcript"></div>
            </details>
          </div>

          <!-- Export Actions -->
          <div class="summary-actions">
            <button id="export-txt-btn" class="btn-primary">Export as TXT</button>
            <button id="export-json-btn" class="btn-primary">Export as JSON</button>
            <button id="copy-summary-btn" class="btn-primary">Copy Summary</button>
            <button id="new-recording-btn" class="btn-secondary">New Recording</button>
          </div>
        </div>

        <div id="summary-placeholder" class="summary-placeholder">
          <p>Complete a recording to see the summary here.</p>
        </div>
      </div>
    </main>

    <!-- New Project Dialog -->
    <div id="new-project-dialog" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Create New Project</h2>
          <button class="modal-close" id="close-project-dialog">&times;</button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="project-name">Project Name *</label>
            <input
              type="text"
              id="project-name"
              placeholder="e.g., Client Meetings"
              required
            />
          </div>

          <div class="form-group">
            <label for="project-description">Description (optional)</label>
            <textarea
              id="project-description"
              rows="3"
              placeholder="Brief description of this project"
            ></textarea>
          </div>
        </div>

        <div class="modal-footer">
          <button id="cancel-project-btn" class="btn-secondary">Cancel</button>
          <button id="create-project-btn" class="btn-primary">Create Project</button>
        </div>
      </div>
    </div>

    <!-- Save Recording Dialog -->
    <div id="save-recording-dialog" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Save Recording</h2>
          <button class="modal-close" id="close-save-dialog">&times;</button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="recording-name">Recording Name *</label>
            <input
              type="text"
              id="recording-name"
              placeholder="e.g., Meeting Notes - Nov 2"
              required
            />
          </div>

          <div class="recording-preview">
            <h4>Preview</h4>
            <p><strong>Project:</strong> <span id="preview-project">-</span></p>
            <p><strong>Duration:</strong> <span id="preview-duration">-</span> seconds</p>
            <p><strong>Words:</strong> <span id="preview-words">-</span></p>
            <p><strong>Turns:</strong> <span id="preview-turns">-</span></p>
          </div>
        </div>

        <div class="modal-footer">
          <button id="cancel-save-btn" class="btn-secondary">Cancel</button>
          <button id="confirm-save-btn" class="btn-primary">Save Recording</button>
        </div>
      </div>
    </div>

    <!-- Recording Detail View -->
    <div id="recording-detail-view" class="detail-view" style="display: none;">
      <div class="detail-header">
        <button id="back-to-list-btn" class="btn-back">‚Üê Back</button>
        <h2 id="detail-recording-name"></h2>
        <div class="detail-actions">
          <button id="detail-generate-summary-btn" class="btn-small btn-primary" style="display: none;">Generate Summary</button>
          <button id="detail-export-btn" class="btn-small">Export</button>
          <button id="detail-rename-btn" class="btn-small">Rename</button>
          <button id="detail-delete-btn" class="btn-small btn-danger">Delete</button>
        </div>
      </div>

      <div class="detail-metadata">
        <div class="metadata-item">
          <span class="metadata-label">Duration</span>
          <span id="detail-metadata-duration">-</span>
        </div>
        <div class="metadata-item">
          <span class="metadata-label">Words</span>
          <span id="detail-metadata-words">-</span>
        </div>
        <div class="metadata-item">
          <span class="metadata-label">Turns</span>
          <span id="detail-metadata-turns">-</span>
        </div>
        <div class="metadata-item">
          <span class="metadata-label">Created</span>
          <span id="detail-metadata-created">-</span>
        </div>
      </div>

      <div class="detail-content">
        <div class="detail-section">
          <h3>Enhanced Transcript</h3>
          <div id="detail-transcript" class="detail-transcript"></div>
        </div>

        <div class="detail-section" id="detail-summary-section" style="display: none;">
          <h3>Summary</h3>
          <div id="detail-summary" class="detail-summary"></div>
        </div>

        <div class="detail-section" id="detail-key-points-section" style="display: none;">
          <h3>Key Points</h3>
          <ul id="detail-key-points" class="detail-key-points"></ul>
        </div>

        <div class="detail-section" id="detail-action-items-section" style="display: none;">
          <h3>Action Items</h3>
          <ul id="detail-action-items" class="detail-action-items"></ul>
        </div>
      </div>
    </div>

    <!-- Settings Dialog -->
    <div id="settings-dialog" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>‚öôÔ∏è Settings</h2>
          <button class="modal-close" id="close-settings-dialog">&times;</button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="device-select">Audio Device *</label>
            <select id="device-select">
              <option value="">Loading devices...</option>
            </select>
            <small>Select the microphone or audio input device for recording</small>
          </div>

          <div class="form-group">
            <label for="api-key-input">AssemblyAI API Key *</label>
            <input
              type="password"
              id="api-key-input"
              placeholder="Enter your AssemblyAI API key"
            />
            <small>Required for real-time speech-to-text transcription. Get your key at <a href="https://www.assemblyai.com" target="_blank">assemblyai.com</a></small>
          </div>

          <div class="form-group">
            <label for="claude-api-key-input">Claude API Key (Optional)</label>
            <input
              type="password"
              id="claude-api-key-input"
              placeholder="Enter your Claude API key"
            />
            <small>Optional. Required for AI-enhanced transcripts and summaries. Get your key at <a href="https://console.anthropic.com" target="_blank">console.anthropic.com</a></small>
          </div>

          <div class="form-group">
            <label>AI Refinement Mode</label>
            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
              <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                <input type="radio" name="refinement-mode" value="disabled" id="refinement-disabled" />
                <span>Disabled - Show raw transcription only</span>
              </label>
              <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                <input type="radio" name="refinement-mode" value="realtime" id="refinement-realtime" />
                <span>Real-time - Refine each turn immediately</span>
              </label>
              <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: normal;">
                <input type="radio" name="refinement-mode" value="chunked" id="refinement-chunked" checked />
                <span>Chunked - Buffer then refine (recommended)</span>
              </label>
            </div>
            <small>Choose how AI enhances your transcripts. Requires Claude API key.</small>
          </div>

          <div class="form-group" id="chunk-duration-group">
            <label for="chunk-duration-input">Chunk Duration (seconds)</label>
            <input
              type="number"
              id="chunk-duration-input"
              min="5"
              max="30"
              value="10"
              step="1"
            />
            <small>How long to buffer before refining (5-30 seconds). Only applies to Chunked mode.</small>
          </div>
        </div>

        <div class="modal-footer">
          <button id="cancel-settings-btn" class="btn-secondary">Cancel</button>
          <button id="save-settings-btn" class="btn-primary">Save Settings</button>
        </div>
      </div>
    </div>

    <!-- Diagnostics Modal -->
    <div id="diagnostics-modal" class="modal" style="display: none;">
      <div class="modal-content diagnostics-modal-content">
        <div class="modal-header">
          <h2>üîç Diagnostics & Logs</h2>
          <button class="modal-close" id="close-diagnostics-modal">&times;</button>
        </div>

        <div class="modal-body">
          <!-- Log Viewer -->
          <div class="diagnostics-section">
            <div class="section-header">
              <h3>üìù Application Logs</h3>
              <div>
                <button id="export-logs-btn" class="btn-small">Export</button>
                <button id="clear-old-logs-btn" class="btn-small">Clear Old</button>
                <button id="refresh-logs-btn" class="btn-small">Refresh</button>
              </div>
            </div>

            <div class="log-info" style="background: #2a2a2a; padding: 12px; border-radius: 4px; margin-bottom: 12px; font-size: 13px;">
              <strong>Debug Logging:</strong> To enable debug logs, set the <code style="background: #1a1a1a; padding: 2px 6px; border-radius: 3px;">RUST_LOG</code> environment variable to <code style="background: #1a1a1a; padding: 2px 6px; border-radius: 3px;">debug</code> or <code style="background: #1a1a1a; padding: 2px 6px; border-radius: 3px;">trace</code> before launching the app.
              Example: <code style="background: #1a1a1a; padding: 2px 6px; border-radius: 3px;">RUST_LOG=debug /path/to/Causal.app</code>
            </div>

            <div class="log-stats">
              <div class="stat-item">
                <span class="stat-label">Log Directory:</span>
                <span id="log-directory" class="stat-value mono">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Total Size:</span>
                <span id="log-total-size" class="stat-value">-</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">File Count:</span>
                <span id="log-file-count" class="stat-value">-</span>
              </div>
            </div>

            <div class="log-viewer">
              <div class="log-controls">
                <label>
                  Show:
                  <select id="log-limit-select">
                    <option value="50">Last 50</option>
                    <option value="100" selected>Last 100</option>
                    <option value="200">Last 200</option>
                    <option value="500">Last 500</option>
                  </select>
                </label>
                <label>
                  Level:
                  <select id="log-level-filter">
                    <option value="ALL">All Levels</option>
                    <option value="ERROR">Errors Only</option>
                    <option value="WARN">Warnings+</option>
                    <option value="INFO">Info+</option>
                    <option value="DEBUG">Debug+</option>
                  </select>
                </label>
              </div>
              <div id="log-entries" class="log-entries"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Rename Recording Dialog -->
    <div id="rename-recording-dialog" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Rename Recording</h2>
          <button class="modal-close" id="close-rename-dialog">&times;</button>
        </div>

        <div class="modal-body">
          <div class="form-group">
            <label for="rename-recording-input">Recording Name *</label>
            <input
              type="text"
              id="rename-recording-input"
              placeholder="Enter new recording name"
              required
            />
          </div>
        </div>

        <div class="modal-footer">
          <button id="cancel-rename-btn" class="btn-secondary">Cancel</button>
          <button id="confirm-rename-btn" class="btn-primary">Rename</button>
        </div>
      </div>
    </div>
  </body>
</html>
